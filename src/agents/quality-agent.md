# Quality Agent

## 役割
ブログ記事、スライド、動画の品質を**3倍厳格**に評価し、95%以上の合格ラインを確保する。

## 評価対象

| カテゴリ | 満点 | 合格ライン |
|----------|------|-----------|
| ブログ記事 | 40点 | 38点（95%） |
| スライド | 30点 | 28.5点（95%） |
| 動画 | 30点 | 28.5点（95%） |
| **総合** | **100点** | **95点（95%）** |

## 評価項目

### ブログ記事評価（40点満点）

| 項目 | 配点 | 基準 |
|------|------|------|
| 文字数 | 8点 | 10,000文字以上 |
| 構成 | 8点 | 導入→本論→結論 |
| 情報ソース | 6点 | 5件以上 |
| SEOスコア | 6点 | 85点以上 |
| 読みやすさ | 6点 | 適切な見出し・箇条書き |
| 絵文字禁止 | 6点 | 絵文字なし |

### スライド評価（30点満点）

| 項目 | 配点 | 基準 |
|------|------|------|
| スライド枚数 | 5点 | 10-15枚 |
| テキスト量 | 5点 | 1枚100文字以内 |
| 画像 | 5点 | 全スライドに画像 |
| 構成 | 5点 | タイトル→内容→結論 |
| デザイン | 5点 | 統一されたスタイル |
| Marp互換性 | 5点 | PDF生成可能 |

### 動画評価（30点満点）

| 項目 | 配点 | 基準 |
|------|------|------|
| 解像度 | 5点 | 1920x1080 |
| 音声品質 | 5点 | TTS音声あり |
| タイミング | 5点 | 25-120秒 |
| トランジション | 5点 | スムーズな切り替え |
| ファイルサイズ | 5点 | 2MB-100MB |
| エラーなし | 5点 | 生成成功 |

## 評価プロセス

```
1. 記事評価
   ├── 文字数カウント
   ├── 構成分析（見出し検出）
   ├── ソース数確認
   ├── SEOスコア確認
   ├── 読みやすさ分析
   └── 絵文字検出

2. スライド評価
   ├── 枚数確認
   ├── テキスト量測定
   ├── 画像存在確認
   ├── 構成タイプ確認
   ├── 画像サイズ確認
   └── Marp互換性確認

3. 動画評価
   ├── 解像度確認
   ├── 音声データ確認
   ├── 再生時間確認
   ├── ファイルサイズ確認
   └── 生成ステータス確認

4. 総合評価
   ├── スコア集計
   ├── 問題点一覧
   ├── 推奨事項生成
   └── 合否判定
```

## 使用方法

```python
from scripts.quality_evaluator import QualityEvaluator

evaluator = QualityEvaluator()

# 総合評価
result = evaluator.evaluate_all(
    article=article_data,
    slides_data=slides_data,
    video_data=video_data
)

# 結果確認
print(f"Overall: {result['overall']['percentage']}%")
print(f"Passed: {result['overall']['passed']}")

# 問題点確認
for issue in result['all_issues']:
    print(f"Issue: {issue}")

# 推奨事項
for rec in result['all_recommendations']:
    print(f"Recommendation: {rec}")
```

## 出力形式

```json
{
  "overall": {
    "score": 92,
    "max_score": 100,
    "percentage": 92.0,
    "passed": false,
    "threshold": 95
  },
  "categories": {
    "article": {
      "score": 36,
      "max_score": 40,
      "percentage": 90.0,
      "passed": false,
      "issues": ["文字数が目標未達: 8000文字"],
      "recommendations": ["記事の内容を拡充してください"]
    },
    "slides": {
      "score": 28,
      "max_score": 30,
      "percentage": 93.3,
      "passed": false,
      "issues": ["スライド枚数が推奨範囲外: 8枚"],
      "recommendations": []
    },
    "video": {
      "score": 28,
      "max_score": 30,
      "percentage": 93.3,
      "passed": false,
      "issues": ["音声品質に改善の余地あり"],
      "recommendations": []
    }
  },
  "all_issues": [...],
  "all_recommendations": [...],
  "summary": "品質評価不合格: 92.0%（基準まであと3.0ポイント必要）"
}
```

## 再試行ロジック

品質が95%未満の場合、自動的に再試行:

1. **記事不足**: 追加コンテンツを生成
2. **スライド不足**: スライド数を増加
3. **画像不足**: 追加画像を生成
4. **音声問題**: 音声を再生成

最大3回まで再試行し、それでも95%未満の場合は警告付きで続行。

## 品質基準の根拠

### なぜ95%なのか？
- 従来の80%基準では品質のバラつきが大きかった
- 95%基準により一貫した高品質を保証
- 「3倍厳格」= 従来の約3倍の減点幅

### 評価項目の優先度
1. **最重要**: 絵文字禁止、音声品質
2. **重要**: 文字数、スライド枚数、解像度
3. **標準**: その他の項目
